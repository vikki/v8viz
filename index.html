<html>
<head>
	<title>Yo!</title>
	<script src="components/underscore/underscore.js"></script>
</head>
<body>
<style>
  .thumb {
    height: 75px;
    border: 1px solid #000;
    margin: 10px 5px 0 0;
  }
</style>

<input type="file" id="files" name="files[]" multiple />
<output id="list"></output>

<script>

   // sweet jesus, rename when more awake
  function findPartsOfOutput(output){
      // HOLY CRAP REFACTOR THIS :S
      var lines = output.split('\n');

      var regexFilter = function(regex, item, index) {
         return item.match(regex);
      };

      var stuffWeWontUseFilter = regexFilter.bind(null, /^((unset key)|(plot)|(set style)|(e)|$)/);
      var setObjFilter = regexFilter.bind(null, /^set object/);
      var setLabelFilter = regexFilter.bind(null, /^set label/);
      var setTicsFilter = regexFilter.bind(null, /^set (x|y)\d?tics/);
      var setRangeFilter = regexFilter.bind(null, /^set (x|y)\d?range/);
      var setAxisLabelFilter = regexFilter.bind(null, /^set (x|y)\d?label/);
      
      // be nice to refactor this into a split thingy that returns the two lists as like a tuple?
      // also it'd be awesome if this were chainable
      // ORR rewrite with underscore groupby - see http://stackoverflow.com/a/11345570/82116
      var rest = _.reject(lines, stuffWeWontUseFilter);
      var setObjLines = _.filter(rest, setObjFilter);
      rest = _.reject(rest, setObjFilter);
      var setLabelLines = _.filter(rest, setLabelFilter);
      rest = _.reject(rest, setLabelFilter);
      var setTicsLines = _.filter(rest, setTicsFilter);
      rest = _.reject(rest, setTicsFilter);
      var setRangeLines = _.filter(rest, setRangeFilter);
      rest = _.reject(rest, setRangeFilter);
      var setAxisLabelLines = _.filter(rest, setAxisLabelFilter);
      rest = _.reject(rest, setAxisLabelFilter);


  }



  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object

    // Loop through the FileList and render image files as thumbnails.
    for (var i = 0, f; f = files[i]; i++) {

      // Only process text files. - could warn instead and try to parse anyway?
      if (!f.type.match('text.*')) {
      	console.log('dude thats not a text file its a ' + f.type + ' file');
        continue;
      }

      var reader = new FileReader();

      reader.onload = (function(theFile) {
        return function(e) {
        	var contents = e.target.result;
        	console.log(contents);
            findPartsOfOutput(contents);
        };
      })(f);

      // Read in the image file as a data URL.
      reader.readAsText(f);
    }
  }

  document.getElementById('files').addEventListener('change', handleFileSelect, false);
</script>

</body>
</html>
